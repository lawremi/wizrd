<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>wizrd • wizrd</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="wizrd">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wizrd</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/wizrd.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lawremi/wizrd" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>wizrd</h1>
                        <h4 data-toc-skip class="author">Michael
Lawrence</h4>
            
            <h4 data-toc-skip class="date">2025-07-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lawremi/wizrd/blob/main/vignettes/wizrd.Rmd" class="external-link"><code>vignettes/wizrd.Rmd</code></a></small>
      <div class="hidden name"><code>wizrd.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The wizrd package exists to test the hypothesis that Large Language
Models (LLMs) can be programmed as functions and integrated with data
science tools and workflows implemented in any programming language. To
accomplish this, wizrd defines a grammar and implements a fluent API for
programming with LLMs.</p>
<p>Just a utility for pretty-printing in Rmd block quotes:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pretty_rmd</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/strwrap.html" class="external-link">strwrap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"&gt;"</span>, text <span class="op">=</span> <span class="va">_</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="quick-start">Quick start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<p>To start analyzing data with an agentl:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lawremi/wizrd" class="external-link">wizrd</a></span><span class="op">)</span></span>
<span><span class="va">agent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convenience-models.html">llamafile_llama</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">agent</span>, <span class="st">"Describe the mtcars dataset"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">pretty_rmd</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>The mtcars dataset is a built-in dataset in R, a popular programming
language for statistical computing and graphics. It was created by John
Fox and Alan S. Blume in 1973 and is often used as a benchmark dataset
in machine learning and data analysis.</p>
<p>Here’s an overview of the mtcars dataset:</p>
<p><strong>Description:</strong> The mtcars dataset contains information
about 32 cars, including their performance characteristics, engine
specifications, and fuel efficiency. The dataset is divided into two
main categories:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Car characteristics:</strong> This includes variables such
as: * <code>mpg</code>: miles per gallon (fuel efficiency) *
<code>cyl</code>: number of cylinders in the engine * <code>disp</code>:
engine displacement (in cubic inches) * <code>hp</code>: horsepower of
the engine * <code>drat</code>: gear ratio * <code>wt</code>: weight of
the car (in thousands of pounds) * <code>qsec</code>: quarter mile time
* <code>vs</code>: vehicle type (0 = automatic, 1 = manual) *
<code>am</code>: transmission type (0 = automatic, 1 = manual) *
<code>gear</code>: number of gears in the transmission <em>
<code>carb</code>: number of carburetors 2. <strong>Car
performance:</strong> This includes variables such as: </em>
<code>vs</code>: vehicle type (0 = automatic, 1 = manual) <em>
<code>am</code>: transmission type (0 = automatic, 1 = manual) </em>
<code>gear</code>: number of gears in the transmission *
<code>carb</code>: number of carburetors</li>
</ol>
<p><strong>Data structure:</strong> The mtcars dataset is a data frame
with 32 rows (one row per car) and 11 columns (variables).</p>
<p><strong>Example:</strong> Here’s a sample of the first few rows of
the mtcars dataset:
<code>r mpg cyl disp hp drat wt qsec vs am gear carb Mazda RX4 21.0 6 160 3.90 2.620 16.46 0 1 4 4 Mazda RX4 Wag 21.0 6 160 3.90 2.875 17.02 0 1 4 4 Datsun 710 22.8 4 108 3.85 2.320 18.61 1 1 4 1</code>
I hope this helps! Let me know if you have any questions or need further
clarification.&lt;|eot_id|&gt;</p>
</blockquote>
<p>The call to <code><a href="../reference/convenience-models.html">llamafile_llama()</a></code> will download, cache and
run the self-contained, cross-platform llamafile binary for the llama
3.2 3B model. Behind the scenes, it starts up a local HTTP server (based
on llama.cpp) through which it communicates with the R process. For more
general use of local LLMs, it is recommended to install Ollama and use
<code><a href="../reference/model-constructors.html">ollama_agent()</a></code> to pull (if necessary) and run agents with
Ollama. The <code><a href="../reference/convenience-models.html">llama()</a></code> function is a convenience to run llama
3.2 3B with Ollama. Convenience functions exist for some other common
models.</p>
<p>The <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function is the most convenient way to
execute single exchanges with an agent. To maintain a context over
multiple exchanges, use the <code><a href="../reference/chat.html">chat()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctx</span> <span class="op">&lt;-</span> <span class="va">agent</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"Describe the mtcars dataset"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"How can I manipulate it in R?"</span><span class="op">)</span></span>
<span><span class="va">ctx</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; &lt;Chat&gt;: 5 messages</span></span>
<span><span class="co">#&gt;  - - - - - - - - - - - - - - - - Latest messages  - - - - - - - - - - - - - - - </span></span>
<span><span class="co">#&gt;                                            ┌───────────────────────────────────┐</span></span>
<span><span class="co">#&gt;                                            │                                   │</span></span>
<span><span class="co">#&gt;                                            │   How can I manipulate it in R?   │</span></span>
<span><span class="co">#&gt;                                            │                                   │</span></span>
<span><span class="co">#&gt;                                            └───────────────────────────────────┘</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; You can manipulate the mtcars dataset in R using various functions and</span></span>
<span><span class="co">#&gt; techniques. Here are a few examples:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **1. View the first few rows of the dataset**</span></span>
<span><span class="co">#&gt; ```r</span></span>
<span><span class="co">#&gt; head(mtcars)</span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt; This will display the first few rows of the dataset.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **2. Get the summary statistics of the dataset**</span></span>
<span><span class="co">#&gt; ```r</span></span>
<span><span class="co">#&gt; summary(mtcars)</span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt; This will display the summary statistics of the dataset, including the mean,</span></span>
<span><span class="co">#&gt; median, and standard deviation of each variable.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **3. Filter the dataset to include only cars with a specific transmission</span></span>
<span><span class="co">#&gt; type**</span></span>
<span><span class="co">#&gt; ```r</span></span>
<span><span class="co">#&gt; mtcars[mtcars$am == 1, ]</span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt; This will return a subset of the dataset that includes only cars with a manual</span></span>
<span><span class="co">#&gt; transmission.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **4. Group the dataset by transmission type and calculate the mean mpg**</span></span>
<span><span class="co">#&gt; ```r</span></span>
<span><span class="co">#&gt; library(dplyr)</span></span>
<span><span class="co">#&gt; mtcars %&gt;%</span></span>
<span><span class="co">#&gt; group_by(am) %&gt;%</span></span>
<span><span class="co">#&gt; summarise(mean_mpg = mean(mpg))</span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt; This will group the dataset by transmission type (am) and calculate the mean</span></span>
<span><span class="co">#&gt; mpg for each group.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **5. Plot a scatterplot of mpg vs. wt**</span></span>
<span><span class="co">#&gt; ```r</span></span>
<span><span class="co">#&gt; plot(mpg ~ wt, data = mtcars)</span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt; This will create a scatterplot of mpg vs. wt.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **6. Calculate the correlation between mpg and wt**</span></span>
<span><span class="co">#&gt; ```r</span></span>
<span><span class="co">#&gt; cor(mpg, wt, mtcars)</span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt; This will calculate the correlation between mpg and wt.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **7. Create a new column for the horsepower**</span></span>
<span><span class="co">#&gt; ```r</span></span>
<span><span class="co">#&gt; mtcars$hp &lt;- mtcars$hp</span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt; This will create a new column called hp in the dataset.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **8. Sort the dataset by mpg in descending order**</span></span>
<span><span class="co">#&gt; ```r</span></span>
<span><span class="co">#&gt; mtcars[order(mtcars$mpg, decreasing = TRUE), ]</span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt; This will sort the dataset by mpg in descending order.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; These are just a few examples of what you can do with the mtcars dataset in R.</span></span>
<span><span class="co">#&gt; I hope this helps! Let me know if you have any questions or need further</span></span>
<span><span class="co">#&gt; assistance.&lt;|eot_id|&gt;</span></span></code></pre>
<p>A useful feature of the returned Chat object is that it prints the
context in a readable format.</p>
<p>To extract the last output from the Chat object, call
<code><a href="../reference/last_output.html">last_output()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/last_output.html">last_output</a></span><span class="op">(</span><span class="va">ctx</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">pretty_rmd</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>You can manipulate the mtcars dataset in R using various functions
and techniques. Here are a few examples:</p>
<p><strong>1. View the first few rows of the dataset</strong>
<code>r head(mtcars)</code> This will display the first few rows of the
dataset.</p>
<p><strong>2. Get the summary statistics of the dataset</strong>
<code>r summary(mtcars)</code> This will display the summary statistics
of the dataset, including the mean, median, and standard deviation of
each variable.</p>
<p><strong>3. Filter the dataset to include only cars with a specific
transmission type</strong> <code>r mtcars[mtcars$am == 1, ]</code> This
will return a subset of the dataset that includes only cars with a
manual transmission.</p>
<p><strong>4. Group the dataset by transmission type and calculate the
mean mpg</strong>
<code>r library(dplyr) mtcars %&gt;% group_by(am) %&gt;% summarise(mean_mpg = mean(mpg))</code>
This will group the dataset by transmission type (am) and calculate the
mean mpg for each group.</p>
<p><strong>5. Plot a scatterplot of mpg vs. wt</strong>
<code>r plot(mpg ~ wt, data = mtcars)</code> This will create a
scatterplot of mpg vs. wt.</p>
<p><strong>6. Calculate the correlation between mpg and wt</strong>
<code>r cor(mpg, wt, mtcars)</code> This will calculate the correlation
between mpg and wt.</p>
<p><strong>7. Create a new column for the horsepower</strong>
<code>r mtcars$hp &lt;- mtcars$hp</code> This will create a new column
called hp in the dataset.</p>
<p><strong>8. Sort the dataset by mpg in descending order</strong>
<code>r mtcars[order(mtcars$mpg, decreasing = TRUE), ]</code> This will
sort the dataset by mpg in descending order.</p>
<p>These are just a few examples of what you can do with the mtcars
dataset in R. I hope this helps! Let me know if you have any questions
or need further assistance.&lt;|eot_id|&gt; The returned value can then
be used in further computations.</p>
</blockquote>
<p>As an exercise, try to create a readline-based chatbot interface. See
<code>wizrd:::readline_chat</code> for one answer.</p>
</div>
<div class="section level2">
<h2 id="llms-as-functions">LLMs as functions<a class="anchor" aria-label="anchor" href="#llms-as-functions"></a>
</h2>
<p>There are three requirements for LLMs to act as functions: 1. Accept
a list of input parameters, each of arbitrary type, 1. Implement a
series of logical operations, potentially delegating to R functions,
including those based on an LLM, and 1. Return an R object of a
specified type and structure.</p>
<p>We will demonstrate how the wizrd package meets each of these
requirements in turn. We will use gpt-4o-mini for this example, in order
to support constrained output. Set the <code>OPENAI_API_KEY</code>
environment variable to your OpenAI key before running this.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model-constructors.html">openai_agent</a></span><span class="op">(</span><span class="st">"gpt-4o-mini"</span>, temperature <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/instruct.html">instruct</a></span><span class="op">(</span><span class="st">"Answer questions about this dataset:"</span>, <span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<p>For reproducibility reasons, it is best to explicitly specify the
underlying model, as above, because the default will change as new
models are released.</p>
<p>The <code><a href="../reference/instruct.html">instruct()</a></code> function configures the agent with a
system prompt, instructing the agent and providing basic context. In
this case, we insert the mtcars dataset verbatim as context, which the
agent can reference in its responses. The agent will now be able to
answer questions about the dataset’s characteristics.</p>
<div class="section level3">
<h3 id="parameterized-input">Parameterized input<a class="anchor" aria-label="anchor" href="#parameterized-input"></a>
</h3>
<p>Let’s extend the above example so that it can analyze any given
variable in the mtcars dataset.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parameterized_agent</span> <span class="op">&lt;-</span> <span class="va">agent</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/prompt_as.html">prompt_as</a></span><span class="op">(</span><span class="st">"Analyze the relationship between {var1} and {var2}."</span><span class="op">)</span></span>
<span><span class="va">parameterized_agent</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var1 <span class="op">=</span> <span class="st">"mpg"</span>, var2 <span class="op">=</span> <span class="st">"wt"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Chat&gt;: 3 messages</span></span>
<span><span class="co">#&gt;  - - - - - - - - - - - - - - - - Latest messages  - - - - - - - - - - - - - - - </span></span>
<span><span class="co">#&gt;                                     ┌──────────────────────────────────────────┐</span></span>
<span><span class="co">#&gt;                                     │                                          │</span></span>
<span><span class="co">#&gt;                                     │   Analyze the relationship between mpg   │</span></span>
<span><span class="co">#&gt;                                     │   and wt.                                │</span></span>
<span><span class="co">#&gt;                                     │                                          │</span></span>
<span><span class="co">#&gt;                                     └──────────────────────────────────────────┘</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To analyze the relationship between miles per gallon (mpg) and weight (wt) in</span></span>
<span><span class="co">#&gt; the provided dataset, we can consider the following points:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1. **Correlation**: Generally, we would expect a negative correlation between</span></span>
<span><span class="co">#&gt; mpg and wt. This means that as the weight of the vehicle increases, the fuel</span></span>
<span><span class="co">#&gt; efficiency (mpg) tends to decrease. Heavier vehicles typically require more</span></span>
<span><span class="co">#&gt; energy to move, which can lead to lower fuel efficiency.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2. **Visual Representation**: A scatter plot of mpg against wt would help</span></span>
<span><span class="co">#&gt; visualize the relationship. Each point on the plot would represent a vehicle,</span></span>
<span><span class="co">#&gt; with its weight on the x-axis and its mpg on the y-axis. A downward trend in</span></span>
<span><span class="co">#&gt; the scatter plot would indicate a negative correlation.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 3. **Statistical Analysis**: Calculating the correlation coefficient (Pearson's</span></span>
<span><span class="co">#&gt; r) would provide a numerical value to quantify the strength and direction of</span></span>
<span><span class="co">#&gt; the relationship. A value close to -1 would indicate a strong negative</span></span>
<span><span class="co">#&gt; correlation, while a value close to 0 would suggest little to no correlation.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 4. **Regression Analysis**: Performing a linear regression analysis could help</span></span>
<span><span class="co">#&gt; in understanding how much of the variation in mpg can be explained by weight.</span></span>
<span><span class="co">#&gt; The regression equation would provide insights into the expected change in mpg</span></span>
<span><span class="co">#&gt; for a unit change in weight.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 5. **Observations from the Data**:</span></span>
<span><span class="co">#&gt; - From the dataset, we can observe that vehicles with lower weights (e.g.,</span></span>
<span><span class="co">#&gt; those weighing around 1.5 to 2.5) tend to have higher mpg values (e.g., 30+</span></span>
<span><span class="co">#&gt; mpg).</span></span>
<span><span class="co">#&gt; - Conversely, heavier vehicles (e.g., those weighing over 3.5) tend to have</span></span>
<span><span class="co">#&gt; lower mpg values (e.g., around 10-15 mpg).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; In summary, the relationship between mpg and wt is expected to be negative,</span></span>
<span><span class="co">#&gt; indicating that as vehicle weight increases, fuel efficiency decreases. Further</span></span>
<span><span class="co">#&gt; statistical analysis would provide more precise insights into this</span></span>
<span><span class="co">#&gt; relationship.</span></span></code></pre></div>
<p>By calling <code><a href="../reference/prompt_as.html">prompt_as()</a></code>, we parameterized the agent using
a glue template to accept parameters named <code>var1</code> and
<code>var2</code>. By passing <code>"mpg"</code> and <code>"wt"</code>
as the variables, we get an analysis of the relationship between fuel
efficiency and weight.</p>
</div>
<div class="section level3">
<h3 id="implementing-logic">Implementing logic<a class="anchor" aria-label="anchor" href="#implementing-logic"></a>
</h3>
<p>We can define the logic of the LLM function using natural language
instructions, inserted into the system prompt, using the
<code><a href="../reference/instruct.html">instruct()</a></code> function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">instructed_agent</span> <span class="op">&lt;-</span> <span class="va">parameterized_agent</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/instruct.html">instruct</a></span><span class="op">(</span><span class="st">"Answer questions about this dataset:"</span>, <span class="va">mtcars</span>,</span>
<span>             <span class="st">"When comparing variables, calculate their correlation."</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="va">instructed_agent</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var1 <span class="op">=</span> <span class="st">"mpg"</span>, var2 <span class="op">=</span> <span class="st">"wt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; &lt;Chat&gt;: 3 messages</span></span>
<span><span class="co">#&gt;  - - - - - - - - - - - - - - - - Latest messages  - - - - - - - - - - - - - - - </span></span>
<span><span class="co">#&gt;                                     ┌──────────────────────────────────────────┐</span></span>
<span><span class="co">#&gt;                                     │                                          │</span></span>
<span><span class="co">#&gt;                                     │   Analyze the relationship between mpg   │</span></span>
<span><span class="co">#&gt;                                     │   and wt.                                │</span></span>
<span><span class="co">#&gt;                                     │                                          │</span></span>
<span><span class="co">#&gt;                                     └──────────────────────────────────────────┘</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To analyze the relationship between miles per gallon (mpg) and weight (wt), we</span></span>
<span><span class="co">#&gt; can calculate the correlation coefficient. The correlation coefficient (often</span></span>
<span><span class="co">#&gt; denoted as "r") measures the strength and direction of a linear relationship</span></span>
<span><span class="co">#&gt; between two variables.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1. **Data Extraction**: We will extract the mpg and wt values from the dataset.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2. **Calculation of Correlation**: We can use the Pearson correlation</span></span>
<span><span class="co">#&gt; coefficient formula, which is given by:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; \[</span></span>
<span><span class="co">#&gt; r = \frac{n(\sum xy) - (\sum x)(\sum y)}{\sqrt{[n\sum x^2 - (\sum x)^2][n\sum</span></span>
<span><span class="co">#&gt; y^2 - (\sum y)^2]}}</span></span>
<span><span class="co">#&gt; \]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; where:</span></span>
<span><span class="co">#&gt; - \( n \) is the number of pairs,</span></span>
<span><span class="co">#&gt; - \( x \) is the mpg values,</span></span>
<span><span class="co">#&gt; - \( y \) is the wt values.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 3. **Interpretation**: The value of r ranges from -1 to 1:</span></span>
<span><span class="co">#&gt; - r = 1 indicates a perfect positive correlation,</span></span>
<span><span class="co">#&gt; - r = -1 indicates a perfect negative correlation,</span></span>
<span><span class="co">#&gt; - r = 0 indicates no correlation.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Let's calculate the correlation coefficient for mpg and wt using the provided</span></span>
<span><span class="co">#&gt; dataset.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Data Points</span></span>
<span><span class="co">#&gt; Here are the mpg and wt values extracted from the dataset:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - mpg: [21, 21, 22.8, 21.4, 18.7, 18.1, 14.3, 24.4, 22.8, 19.2, 17.8, 16.4,</span></span>
<span><span class="co">#&gt; 17.3, 15.2, 10.4, 10.4, 14.7, 32.4, 30.4, 33.9, 21.5, 15.5, 15.2, 13.3, 19.2,</span></span>
<span><span class="co">#&gt; 27.3, 26, 30.4, 15.8, 19.7, 15, 21.4]</span></span>
<span><span class="co">#&gt; - wt: [2.62, 2.875, 2.32, 3.215, 3.44, 3.46, 3.57, 3.19, 3.15, 3.44, 3.44,</span></span>
<span><span class="co">#&gt; 4.07, 3.73, 3.78, 5.25, 5.424, 5.345, 2.2, 1.615, 1.835, 2.465, 3.52, 3.435,</span></span>
<span><span class="co">#&gt; 3.84, 3.845, 1.935, 2.14, 1.513, 3.17, 2.77, 3.57, 2.78]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Calculation</span></span>
<span><span class="co">#&gt; Using statistical software or a programming language like Python, we can</span></span>
<span><span class="co">#&gt; compute the correlation coefficient.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; For example, using Python's `numpy` library:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ```python</span></span>
<span><span class="co">#&gt; import numpy as np</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; mpg = np.array([21, 21, 22.8, 21.4, 18.7, 18.1, 14.3, 24.4, 22.8, 19.2, 17.8,</span></span>
<span><span class="co">#&gt; 16.4, 17.3, 15.2, 10.4, 10.4, 14.7, 32.4, 30.4, 33.9, 21.5, 15.5, 15.2, 13.3,</span></span>
<span><span class="co">#&gt; 19.2, 27.3, 26, 30.4, 15.8, 19.7, 15, 21.4])</span></span>
<span><span class="co">#&gt; wt = np.array([2.62, 2.875, 2.32, 3.215, 3.44, 3.46, 3.57, 3.19, 3.15, 3.44,</span></span>
<span><span class="co">#&gt; 3.44, 4.07, 3.73, 3.78, 5.25, 5.424, 5.345, 2.2, 1.615, 1.835, 2.465, 3.52,</span></span>
<span><span class="co">#&gt; 3.435, 3.84, 3.845, 1.935, 2.14, 1.513, 3.17, 2.77, 3.57, 2.78])</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; correlation = np.corrcoef(mpg, wt)[0, 1]</span></span>
<span><span class="co">#&gt; print(correlation)</span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Result</span></span>
<span><span class="co">#&gt; After running the calculation, you would find that the correlation coefficient</span></span>
<span><span class="co">#&gt; between mpg and wt is approximately -0.87.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Conclusion</span></span>
<span><span class="co">#&gt; This indicates a strong negative correlation between mpg and weight. As the</span></span>
<span><span class="co">#&gt; weight of the vehicle increases, the miles per gallon (fuel efficiency) tends</span></span>
<span><span class="co">#&gt; to decrease. This is consistent with the understanding that heavier vehicles</span></span>
<span><span class="co">#&gt; generally consume more fuel.</span></span></code></pre>
<p>The agent will now provide a more structured analysis including
correlation, interpretation, and visualization suggestions. However, it
is not able to carry out the correlation calculation.</p>
<p>To solve this, we can provide a tool that performs the actual
correlation calculation:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calculate_correlation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">var1</span>, <span class="va">var2</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[[</span><span class="va">var1</span><span class="op">]</span><span class="op">]</span>, <span class="va">mtcars</span><span class="op">[[</span><span class="va">var2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">equipped_agent</span> <span class="op">&lt;-</span> <span class="va">instructed_agent</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/equip.html">equip</a></span><span class="op">(</span><span class="va">calculate_correlation</span><span class="op">)</span></span>
<span><span class="va">equipped_agent</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var1 <span class="op">=</span> <span class="st">"mpg"</span>, var2 <span class="op">=</span> <span class="st">"wt"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Chat&gt;: 5 messages</span></span>
<span><span class="co">#&gt;  - - - - - - - - - - - - - - - - Latest messages  - - - - - - - - - - - - - - - </span></span>
<span><span class="co">#&gt;                               + call_5EmiaTkb3iMa… +</span></span>
<span><span class="co">#&gt;                               |                    |</span></span>
<span><span class="co">#&gt;                               |   [1] -0.8676594   |</span></span>
<span><span class="co">#&gt;                               |                    |</span></span>
<span><span class="co">#&gt;                               +--------------------+</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The correlation coefficient between miles per gallon (mpg) and weight (wt) is</span></span>
<span><span class="co">#&gt; approximately -0.87. This indicates a strong negative correlation, meaning that</span></span>
<span><span class="co">#&gt; as the weight of the vehicle increases, the miles per gallon tends to decrease.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="constraining-output">Constraining output<a class="anchor" aria-label="anchor" href="#constraining-output"></a>
</h3>
<p>In order to incorporate the output into a larger program, it is often
necessary to convert the output to a more standardized and computable
object. We can use the <code><a href="../reference/output_as.html">output_as()</a></code> function to structure
our analysis results:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Return the correlation as a single number</span></span>
<span><span class="va">equipped_agent</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/output_as.html">output_as</a></span><span class="op">(</span><span class="fu">S7</span><span class="fu">::</span><span class="va"><a href="https://rconsortium.github.io/S7/reference/base_classes.html" class="external-link">class_numeric</a></span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var1 <span class="op">=</span> <span class="st">"mpg"</span>, var2 <span class="op">=</span> <span class="st">"wt"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.8676594</span></span>
<span></span>
<span><span class="co"># Return a filtered subset of mtcars, which serves as the prototype</span></span>
<span><span class="va">filtered_agent</span> <span class="op">&lt;-</span> <span class="va">agent</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/output_as.html">output_as</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">filtered_agent</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="st">"Cars with mpg &gt; 20"</span><span class="op">)</span></span>
<span><span class="co">#&gt;     mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span></span>
<span><span class="co">#&gt; 1  21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4</span></span>
<span><span class="co">#&gt; 2  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4</span></span>
<span><span class="co">#&gt; 3  22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1</span></span>
<span><span class="co">#&gt; 4  24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2</span></span>
<span><span class="co">#&gt; 5  22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2</span></span>
<span><span class="co">#&gt; 6  21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1</span></span>
<span><span class="co">#&gt; 7  27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1</span></span>
<span><span class="co">#&gt; 8  30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2</span></span>
<span><span class="co">#&gt; 9  32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1</span></span>
<span><span class="co">#&gt; 10 30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2</span></span>
<span></span>
<span><span class="co"># Return a summary data.frame</span></span>
<span><span class="va">summary_agent</span> <span class="op">&lt;-</span> <span class="va">agent</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/output_as.html">output_as</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        avg_mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        avg_hp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">summary_agent</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="st">"Average mpg and hp by number of cylinders."</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cyl avg_mpg avg_hp</span></span>
<span><span class="co">#&gt; 1   4    24.1   91.5</span></span>
<span><span class="co">#&gt; 2   6    18.9  122.5</span></span>
<span><span class="co">#&gt; 3   8    15.1  209.5</span></span>
<span></span>
<span><span class="co"># Using class_data.frame for more general output</span></span>
<span><span class="va">agent</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/output_as.html">output_as</a></span><span class="op">(</span><span class="fu">S7</span><span class="fu">::</span><span class="va"><a href="https://rconsortium.github.io/S7/reference/base_s3_classes.html" class="external-link">class_data.frame</a></span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="st">"Top 5 most fuel efficient cars including mpg, hp, and wt."</span><span class="op">)</span></span>
<span><span class="co">#&gt;    mpg  hp    wt</span></span>
<span><span class="co">#&gt; 1 33.9  65 1.835</span></span>
<span><span class="co">#&gt; 2 32.4  66 2.200</span></span>
<span><span class="co">#&gt; 3 30.4  52 1.615</span></span>
<span><span class="co">#&gt; 4 30.4 113 1.513</span></span>
<span><span class="co">#&gt; 5 27.3  66 1.935</span></span></code></pre></div>
<p>In the above examples, we demonstrate different ways to structure the
output: 1. Using an existing data.frame (<code>mtcars</code>) as a
template 2. Using a data.frame stub with specific columns 3. Using
<code>class_data.frame</code> for more general output</p>
<p>The agent will return properly structured data.frames that can be
used directly in further analysis or visualization.</p>
<p>Note that <code><a href="../reference/output_as.html">output_as()</a></code> supports any S7 class as a
constraint, not just data.frames. This allows for type-safe conversion
of agent outputs into any R object structure defined using S7.</p>
</div>
<div class="section level3">
<h3 id="converting-an-agent-to-an-actual-r-function">Converting an agent to an actual R function<a class="anchor" aria-label="anchor" href="#converting-an-agent-to-an-actual-r-function"></a>
</h3>
<p>Since the agent is already behaving like a function, it is relatively
straightforward to convert it into an actual R function using the
<code>convert()</code> generic from S7:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert the filtered agent to a function</span></span>
<span><span class="va">filter_cars</span> <span class="op">&lt;-</span> <span class="fu">S7</span><span class="fu">::</span><span class="fu"><a href="https://rconsortium.github.io/S7/reference/convert.html" class="external-link">convert</a></span><span class="op">(</span><span class="va">filtered_agent</span>, <span class="fu">S7</span><span class="fu">::</span><span class="va"><a href="https://rconsortium.github.io/S7/reference/base_classes.html" class="external-link">class_function</a></span><span class="op">)</span></span>
<span><span class="fu">filter_cars</span><span class="op">(</span><span class="st">"Cars with mpg &gt; 30"</span><span class="op">)</span></span>
<span><span class="co">#&gt;    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></span>
<span><span class="co">#&gt; 1 32.4   4 78.7  66 4.08 2.200 19.47  1  1    4    1</span></span>
<span><span class="co">#&gt; 2 30.4   4 75.7  52 4.93 1.615 18.52  1  1    4    2</span></span>
<span><span class="co">#&gt; 3 30.4   4 95.1 113 3.77 1.513 16.90  1  1    5    2</span></span>
<span><span class="co">#&gt; 4 33.9   4 71.1  65 4.22 1.835 19.90  1  1    4    1</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="additional-features">Additional features<a class="anchor" aria-label="anchor" href="#additional-features"></a>
</h2>
<div class="section level3">
<h3 id="model-context-protocol-mcp">Model Context Protocol (MCP)<a class="anchor" aria-label="anchor" href="#model-context-protocol-mcp"></a>
</h3>
<p>The wizrd package implements a client for the Model Context Protocol
(MCP), which enables constructing agents from shared ingredients,
including tools, prompts, and resources.</p>
<p>Here’s an example of using MCP to interact with a data analysis
server:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Start the data analysis server</span></span>
<span><span class="va">data_server.py</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"mcp"</span>, <span class="st">"data_server.py"</span>,</span>
<span>                              package <span class="op">=</span> <span class="st">"wizrd"</span><span class="op">)</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcp.html">start_mcp</a></span><span class="op">(</span><span class="va">data_server.py</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create an MCP session</span></span>
<span><span class="va">session</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcp.html">connect_mcp</a></span><span class="op">(</span><span class="va">server</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># List available tools</span></span>
<span><span class="va">tools</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcp.html">tools</a></span><span class="op">(</span><span class="va">session</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tools are just ordinary R functions</span></span>
<span><span class="va">tools</span><span class="op">$</span><span class="fu">get_mean</span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "20.090625"</span></span>
<span></span>
<span><span class="co"># Equip a agent with the MCP tools and analyze the data</span></span>
<span><span class="va">mcp_agent</span> <span class="op">&lt;-</span> <span class="va">agent</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/output_as.html">output_as</a></span><span class="op">(</span><span class="fu">S7</span><span class="fu">::</span><span class="va"><a href="https://rconsortium.github.io/S7/reference/base_classes.html" class="external-link">class_numeric</a></span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/equip.html">equip</a></span><span class="op">(</span><span class="va">tools</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mcp_agent</span>, <span class="st">"What is the mean fuel efficiency in the mtcars dataset?"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20.09062</span></span></code></pre></div>
<p>The MCP protocol provides a standardized way to: 1. Discover
available tools, prompts, and resources 2. Call tools with structured
arguments 3. Access and use predefined prompts 4. Handle resources and
templates</p>
<p>This makes it easier to work with different agent implementations
while maintaining a consistent interface in R.</p>
</div>
<div class="section level3">
<h3 id="retrieval-augmented-generation-rag">Retrieval Augmented Generation (RAG)<a class="anchor" aria-label="anchor" href="#retrieval-augmented-generation-rag"></a>
</h3>
<p>The wizrd package implements experimental functionality for Retrieval
Augmented Generation (RAG). One potentially useful application is in the
querying of R manual pages.</p>
<div class="section level4">
<h4 id="querying-rd">Querying Rd<a class="anchor" aria-label="anchor" href="#querying-rd"></a>
</h4>
<p>The code below uses the <code><a href="../reference/chunk.html">chunk()</a></code> generic to generate text
chunks from the S7 man pages. Next, it creates a TextStore that indexes
those chunks using the nomic text embedding model. It then configures
the prompt generator to query the text store for chunks that are similar
to the query. Finally, it sends the query for an example of the
<code><a href="https://rconsortium.github.io/S7/reference/new_property.html" class="external-link">S7::new_property()</a></code> function.</p>
<p>The <code><a href="../reference/chunk.html">chunk()</a></code> utility has basic support for a number of
formats, including markdown derivatives, HTML and PDF.</p>
<p>Since the output is markdown, we embed it directly in this
document.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chunks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chunk.html">chunk</a></span><span class="op">(</span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/Rdutils.html" class="external-link">Rd_db</a></span><span class="op">(</span><span class="st">"S7"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">store</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/text_store.html">text_store</a></span><span class="op">(</span><span class="fu"><a href="../reference/convenience-models.html">nomic</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">chunks</span><span class="op">)</span></span>
<span><span class="va">agent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convenience-models.html">llama</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/prompt_as.html">prompt_as</a></span><span class="op">(</span><span class="fu"><a href="../reference/rag_with.html">rag_with</a></span><span class="op">(</span><span class="va">store</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"#### new_property example\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; #### new_property example</span></span>
<span><span class="fu"><a href="../reference/last_output.html">last_message</a></span><span class="op">(</span><span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="va">agent</span>, <span class="st">"new_property example"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Here's an example of using the `new_property` function in R:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ```r</span></span>
<span><span class="co">#&gt; # Define a new property for a class called "Person"</span></span>
<span><span class="co">#&gt; person_class &lt;- new_class("Person", properties = list(</span></span>
<span><span class="co">#&gt; name = new_property(class_character, default = "John"),</span></span>
<span><span class="co">#&gt; age = new_property(class_numeric)</span></span>
<span><span class="co">#&gt; ))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Create an instance of the Person class with default values</span></span>
<span><span class="co">#&gt; john &lt;- person_class()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Print the initial values of the properties</span></span>
<span><span class="co">#&gt; print(john$name) # prints: John</span></span>
<span><span class="co">#&gt; print(john$age) # prints: NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Update the name property and print the result</span></span>
<span><span class="co">#&gt; john$name &lt;- "Jane"</span></span>
<span><span class="co">#&gt; print(john$name) # prints: Jane</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Create a new instance with custom values for both properties</span></span>
<span><span class="co">#&gt; jane &lt;- person_class(name = "Jane", age = 30)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Print the initial values of the properties</span></span>
<span><span class="co">#&gt; print(jane$name) # prints: Jane</span></span>
<span><span class="co">#&gt; print(jane$age) # prints: 30</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Update the age property and print the result</span></span>
<span><span class="co">#&gt; jane$age &lt;- 31</span></span>
<span><span class="co">#&gt; print(jane$age) # prints: 31</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Use a dynamic property to compute on demand</span></span>
<span><span class="co">#&gt; clock_class &lt;- new_class("Clock", properties = list(</span></span>
<span><span class="co">#&gt; now = new_property(getter = function(self) Sys.time())</span></span>
<span><span class="co">#&gt; ))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; my_clock &lt;- clock_class()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Print the initial value of the now property</span></span>
<span><span class="co">#&gt; print(my_clock$now) # prints: current time</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Wait for a second and print the updated value of the now property</span></span>
<span><span class="co">#&gt; Sys.sleep(1)</span></span>
<span><span class="co">#&gt; print(my_clock$now) # prints: new current time</span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; In this example, we define two classes: `Person` with properties `name` and</span></span>
<span><span class="co">#&gt; `age`, and `Clock` with a dynamic property `now`. We create instances of these</span></span>
<span><span class="co">#&gt; classes with default values or custom values for the properties. We also</span></span>
<span><span class="co">#&gt; demonstrate how to use dynamic properties to compute on demand.</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="querying-a-data-frame">Querying a data.frame<a class="anchor" aria-label="anchor" href="#querying-a-data-frame"></a>
</h4>
<p>And here is an example of querying a data.frame using RAG:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chunks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chunk.html">chunk</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">store</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/text_store.html">text_store</a></span><span class="op">(</span><span class="fu"><a href="../reference/convenience-models.html">nomic</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">chunks</span><span class="op">)</span></span>
<span><span class="va">agent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convenience-models.html">llama</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/prompt_as.html">prompt_as</a></span><span class="op">(</span><span class="fu"><a href="../reference/rag_with.html">rag_with</a></span><span class="op">(</span><span class="va">store</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">agent</span>, <span class="st">"MPG of Datsun 710"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The MPG (miles per gallon) of the Datsun 710 is 22.8."</span></span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael Lawrence.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
